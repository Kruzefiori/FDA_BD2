// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

generator erd {
  provider     = "prisma-erd-generator"
  output       = "./erd.pdf"
  theme        = "forest"
  disableEmoji = true
}

datasource db {
  provider = "postgresql"
  url      = "postgresql://unifei:unifei@localhost:5433/UNIFEI?schema=public"
}

enum Role {
  USER
  ADMIN
}

model User {
  id       Int    @id @default(autoincrement())
  name     String
  email    String @unique
  password String
  role     Role   @default(USER)
}

model DrugBase {
  name       String
  strength   String
  dosageForm String
  route      String
  Drug       Drug[]

  @@id([name, strength])
}

model Shortages {
  id                 Int      @id @default(autoincrement())
  drugId             Int
  dosageForm         String
  description        String?
  initialPostingDate DateTime
  presentation       String
  Drug               Drug     @relation(fields: [drugId], references: [id], onDelete: Cascade)
}

model Company {
  name      String @id
  drugCount Int    @default(0)
  Drugs     Drug[]
}

model AdverseReaction {
  name        String                      @id
  drugs       RelAdverseReactionXDrug[]
  reportDrugs RelAdverseReactionXReport[]
}

model Report {
  id               Int                         @id @default(autoincrement())
  occurCountry     String
  transmissionDate DateTime
  patientAge       Int?
  patientGender    String?
  patientWeight    Int?
  drugs            RelReportXDrug[]
  adverseReactions RelAdverseReactionXReport[]
}

model ActiveIngredient {
  name     String
  strength String
  drugs    RelActiveIngredientXDrug[]

  @@id([name, strength])
}

model RelActiveIngredientXDrug {
  id                       Int              @id @default(autoincrement())
  activeIngredientName     String
  activeIngredientStrength String
  drugId                   Int
  ActiveIngredient         ActiveIngredient @relation(fields: [activeIngredientName, activeIngredientStrength], references: [name, strength], onDelete: Cascade)
  Drug                     Drug             @relation(fields: [drugId], references: [id], onDelete: Cascade)
}

model RelAdverseReactionXDrug {
  id              Int             @id @default(autoincrement())
  drugId          Int
  adverseReaction String
  Drug            Drug            @relation(fields: [id], references: [id], onDelete: Cascade)
  AdverseReaction AdverseReaction @relation(fields: [adverseReaction], references: [name], onDelete: Cascade)
}

model RelAdverseReactionXReport {
  id              Int             @id @default(autoincrement())
  reportId        Int
  adverseReaction String
  Report          Report          @relation(fields: [reportId], references: [id], onDelete: Cascade)
  AdverseReaction AdverseReaction @relation(fields: [adverseReaction], references: [name], onDelete: Cascade)
}

model RelReportXDrug {
  id       Int    @id @default(autoincrement())
  reportId Int
  drugId   Int
  Report   Report @relation(fields: [reportId], references: [id], onDelete: Cascade)
  Drug     Drug   @relation(fields: [drugId], references: [id], onDelete: Cascade)
}

model Drug {
  id                       Int                        @id @default(autoincrement())
  companyName              String
  drugName                 String
  drugStrength             String
  DrugBase                 DrugBase                   @relation(fields: [drugName, drugStrength], references: [name, strength], onDelete: Cascade)
  Company                  Company                    @relation(fields: [companyName], references: [name], onDelete: Cascade)
  Shortages                Shortages[]
  RelActiveIngredientXDrug RelActiveIngredientXDrug[]
  RelAdverseReactionXDrug  RelAdverseReactionXDrug[]
  RelReportXDrug           RelReportXDrug[]
}
